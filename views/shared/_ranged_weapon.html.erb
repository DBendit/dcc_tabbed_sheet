<% present_attr_name(suffix: attr_suffix) do |attr| %>
  <div class="sheet-row">
    <input type="hidden" name="<%= attr.name "thrownShortRangeBonus" %>" value="0" readonly="readonly">
    <input type="hidden" name="<%= attr.name "mediumRangePenalty" %>" value="0" readonly="readonly">
    <input type="hidden" name="<%= attr.name "rangedAttackEffectiveDice" %>" value="0" readonly="readonly">
    <div class="sheet-col-1-24"><input class="sheet-center" type="text" name="<%= attr.name "rangedAmmo" %>" value="0"></div>
    <div class="sheet-col-1-6"><input type="text" name="<%= attr.name "rangedWeaponName" %>"></div>
    <div class="sheet-col-1-24"><input class="sheet-center" type="text" name="<%= attr.name "rangedDistanceShort" %>" value="0"></div>
    <div class="sheet-col-1-24"><input class="sheet-center" type="text" name="<%= attr.name "rangedDistanceMed" %>" value="0"></div>
    <div class="sheet-col-1-24"><input class="sheet-center" type="text" name="<%= attr.name "rangedDistanceLong" %>" value="0"></div>
    <div class="sheet-col-1-12" title="If you are not trained in your weapon use, you take -1 die for your attack roll.  You will also take a minus to your dice chain if using two-weapon fighting or shooting from long range.">
      <select name="<%= attr.name "rangedAttackDice" %>">
        <option value="d30">d30</option>
        <option value="d24">d24</option>
        <option value="d20" selected="selected">d20</option>
        <option value="d16">d16</option>
        <option value="d14">d14</option>
        <option value="d12">d12</option>
        <option value="d10">d10</option>
        <option value="d8">d8</option>
        <option value="d7">d7</option>
        <option value="d6">d6</option>
        <option value="d5">d5</option>
        <option value="d4">d4</option>
        <option value="d3">d3</option>
      </select>
    </div>
    <div class="sheet-col-1-12" title="Your critical threat range goes up, if your dice on the dice chain goes up.">
      <select name="<%= attr.name "rangedCritThreat" %>">
        <option value="30">30</option>
        <option value="29">29-30</option>
        <option value="28">28-30</option>
        <option value="27">27-30</option>
        <option value="24">24</option>
        <option value="23">23-24</option>
        <option value="22">22-24</option>
        <option value="21">21-24</option>
        <option value="20" selected="selected">20</option>
        <option value="19">19-20</option>
        <option value="18">18-20</option>
        <option value="17">17-20</option>
      </select>
    </div>
    <div class="sheet-col-1-24"><input class="sheet-center" type="number" name="<%= attr.name "rangedToHit" %>" value="[[ [[@{agiMod}]] + @{allAtkLuckyRoll} + @{rangedAtkLuckyRoll} + @{<%= attr.roll "rangedMagic" %>} + @{<%= attr.roll "rangedOtherToHitBonus" %>} + @{<%= attr.roll "rangedAtkLuckyWeapon" %>} + @{ATK} + @{<%= attr.roll "zeroRangedWeaponLuckyRoll" %>}]]" disabled="disabled"></div>
    <div class="sheet-col-1-24" title="Only enter the base damage roll here without any bonuses from stats or other sources"><input class="sheet-center" type="text" name="<%= attr.name "rangedDmg" %>" value="1d4"></div>
    <div class="sheet-col-1-24"><input class="sheet-center" type="number" name="<%= attr.name "rangedDmgBonus" %>" value="[[@{<%= attr.roll "rangedMagic" %>} + @{<%= attr.roll "rangedOtherDamageBonus" %>} + @{rangedDmgLuckyRoll} + @{dmgLuckyRoll} + @{<%= attr.roll "zeroRangedWeaponLuckyRoll" %>}]]" disabled="disabled"></div>
    <div class="sheet-col-1-12" title="Short range: no penalty&#10;Medium range: -2 on attack roll&#10;Long ranged: -1d on attack roll">
      <select name="<%= attr.name "attackRange" %>">
        <option value="Short">Short</option>
        <option value="Medium">Med</option>
        <option value="Long">Long</option>
      </select>
    </div>

    <div class="sheet-col-1-24 sheet-checkbox-row" title="Check for advanced options">
      <input type="checkbox" value="@{<%= attr.roll "rangedShowAdvanced" %>}" name="<%= attr.name "rangedShowAdvanced" %>" class="sheet-ranged-advanced">
    </div>

    <div class="sheet-col-1-21">
      <button type='roll' class="sheet-roll" name="roll_rangedWeaponAttack" title="Ranged Weapon"
                                                                            value="&{template:DccTabbed} {{background=[[0]]}} {{combat=1}} {{name=@{character_name} }} {{title=@{<%= attr.roll "rangedWeaponName" %>} \n @{<%= attr.roll "rangedDistanceShort" %>} / @{<%= attr.roll "rangedDistanceMed" %>} / @{<%= attr.roll "rangedDistanceLong" %>} }} {{range=@{<%= attr.roll "attackRange" %>} }} {{rangedtype=Ranged Type}} {{type=@{<%= attr.roll "rangedWeaponType" %>} }} {{rangedattack=[[ @{<%= attr.roll "rangedAttackEffectiveDice" %>}cs>@{<%= attr.roll "rangedCritThreat" %>} [To Hit Roll] + @{<%= attr.roll "rangedToHit" %>} [To Hit Bonus] + (?{Deed/Smite Die roll|0}) [Deed/Smite Die] + (?{Any Attack Bonus|0}) [Attack Bonus] - @{<%= attr.roll "mediumRangePenalty" %>} [Medium Range Penalty] ]] }} {{damage=[[ @{<%= attr.roll "rangedDmg" %>} [Base damage] + @{<%= attr.roll "rangedDmgBonus" %>} [Damage Bonus] + (?{Deed/Smite Die roll|0}) [Deed/Smite Die] + @{<%= attr.roll "thrownShortRangeBonus" %>} [Short Range Thrown Weapon STR Mod] ]] }} {{crit=[[ @{CritDie}[Dice Roll] + [[@{luckMod}]][Current Luck] + @{critLuckyRoll}[Crit Lucky Roll] ]] }} {{crittable=@{CritDie|max} }} {{fumble=[[ @{armorFumbleDie} + [[@{fumbleCheck}]] + [[@{fumbleLuckyRoll}]] ]] }} {{notes=@{<%= attr.roll "rangedWeaponSpecial" %>}}}">Atk</button>
    </div>

    <div class="sheet-col-1-12">
      <button type='roll' class="sheet-roll" name="roll_rangedWeaponAttackWithDeed" title="Ranged Weapon Attack with Mighty Deed" value="&{template:DccTabbed} [[ @{<%= attr.roll "rangedAttackEffectiveDice" %>}cs>@{<%= attr.roll "rangedCritThreat" %>} [To Hit Roll] + [[@{DeedDie}cs>3]] [Deed Die] + @{<%= attr.roll "rangedToHit" %>} [To Hit Bonus] + (?{Any Attack Bonus|0}) [Attack Bonus]  ]] {{background=[[0]]}} {{combat=1}} {{name=@{character_name}}} {{title=@{<%= attr.roll "rangedWeaponName" %>} \n @{<%= attr.roll "rangedDistanceShort" %>} / @{<%= attr.roll "rangedDistanceMed" %>} / @{<%= attr.roll "rangedDistanceLong" %>}}} {{range=@{<%= attr.roll "attackRange" %>} }} {{rangedtype=Ranged Type}} {{type=@{<%= attr.roll "rangedWeaponType" %>} }} {{rangedAttackWithDeed=$[[1]] }} {{deedroll=$[[0]] }} {{damage=[[ ({(@{<%= attr.roll "rangedDmg" %>} [Base damage] + @{<%= attr.roll "rangedDmgBonus" %>} [Damage Bonus]),1d1}kh1) ]] + $[[0]] [Deed]}} {{crit=[[ @{CritDie} + [[@{luckMod}]] + @{critLuckyRoll} ]]}} {{crittable=@{CritDie|max}}} {{fumble=[[ @{armorFumbleDie} + [[@{fumbleCheck}]] + [[@{fumbleLuckyRoll}]] ]]}} {{notes=@{<%= attr.roll "rangedWeaponSpecial" %>}}}">w/ Deed</button>
    </div>

    <div class="sheet-col-1-11">
      <button type='roll' class="sheet-roll" name="roll_rangedWeaponBackstab" title="Ranged Weapon Backstab"
      value="&{template:DccTabbed} {{background=[[0]]}} {{combat=1}} {{name=@{character_name} }} {{title=Backstab with @{<%= attr.roll "rangedWeaponName" %>} \n @{<%= attr.roll "rangedDistanceShort" %>} / @{<%= attr.roll "rangedDistanceMed" %>} / @{<%= attr.roll "rangedDistanceLong" %>} }} {{flavortext=You attack the enemy from behind or when they are unaware.  If the attack hits, it is a critical hit.}} {{range=@{<%= attr.roll "attackRange" %>} }} {{type=@{<%= attr.roll "rangedWeaponType" %>} }} {{rangedbackstab=[[ @{<%= attr.roll "rangedAttackEffectiveDice" %>} [To Hit Roll] + @{<%= attr.roll "rangedToHit" %>} [To Hit Bonus] + @{ThiefBackstabCheck} [Backstab Bonus] + (?{Any Attack Bonus|0}) [Attack Bonus] - @{<%= attr.roll "mediumRangePenalty" %>} [Medium Range Penalty] ]] }} {{damage=[[ @{<%= attr.roll "rangedBackstabDmg" %>} [Base damage] + @{<%= attr.roll "rangedDmgBonus" %>} [Damage Bonus] + @{<%= attr.roll "thrownShortRangeBonus" %>} [Short Range Thrown Weapon STR Mod] ]] }} {{crit=[[ @{CritDie}[Dice Roll] + [[@{luckMod}]][Current Luck] + @{critLuckyRoll}[Crit Lucky Roll] ]] }} {{crittable=@{CritDie|max} }} {{fumble=[[ @{armorFumbleDie} + [[@{fumbleCheck}]] + [[@{fumbleLuckyRoll}]] ]] }} {{notes=@{<%= attr.roll "rangedWeaponSpecial" %>}}}">Backstab</button>
    </div>

    <input type="checkbox" value="@{<%= attr.roll "rangedShowAdvanced" %>}" name="<%= attr.name "rangedShowAdvanced" %>" class="sheet-ranged-advanced2 sheet-hidden">

    <div class="sheet-ranged-advanced sheet-row">
      <div class="sheet-row">
        <div class="sheet-col-1-6 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Magic Bonus:</div>
        <div class="sheet-col-1-24" title="The magic bonus will be added as a bonus to BOTH the attack and damage rolls">
          <input class=" sheet-center" type="number" name="<%= attr.name "rangedMagic" %>" value="0">
        </div>
        <div class="sheet-col-1-8 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">To Hit bonus:</div>
        <div class="sheet-col-1-24" title="Bonus added to ONLY hit rolls">
          <input class=" sheet-center" type="number" name="<%= attr.name "rangedOtherToHitBonus" %>" value="0">
        </div>
        <div class="sheet-col-1-6 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Backstab damage:</div>
        <div class="sheet-col-1-12" title="Enter the damage done on a backstab here. Usually this is the same as the normal damage dice"><input class="sheet-center" value="" type="text" name="<%= attr.name "rangedBackstabDmg" %>"></div>
        <div class="sheet-col-1-8 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Lucky Weapon:</div>
        <div class="sheet-col-1-24 sheet-checkbox-row sheet-vert-middle" title="Check the box if this is your Lucky Weapon (Class ability)"><input type="checkbox" value="@{luckStartingMod}" name="<%= attr.name "rangedAtkLuckyWeapon" %>"></div>
      </div>

      <div class="sheet-row">
        <div class="sheet-col-1-3 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Damage bonus:</div>
        <div class="sheet-col-1-24" title="Bonus added to ONLY to damage rolls">
          <input class=" sheet-center" type="number" name="<%= attr.name "rangedOtherDamageBonus" %>" value="0">
        </div>
        <div class="sheet-col-1-8 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Missle Type:</div>
        <div class="sheet-col-1-8" title="Select Thrown or Missile weapon">
          <select name="<%= attr.name "rangedWeaponType" %>">
            <option value="Thrown">Thrown</option>
            <option value="Missile" selected="selected">Missile</option>
          </select>
        </div>
        <div class="sheet-col-1-8 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Pack Hunter:</div>
        <div class="sheet-col-1-24 sheet-checkbox-row sheet-vert-middle" title="Check the box if you have the Lucky Roll for 0-level Starting weapon"><input type="checkbox" value="@{luckStartingMod}" name="<%= attr.name "zeroRangedWeaponLuckyRoll" %>"></div>
      </div>
      <div class="sheet-row" title="Enter other notes here; they will be shown during attacks, and can include rolls. Ex: +1d4 damage vs trolls: [[1d4]]">
        <div class="sheet-col-3-20 sheet-right sheet-padr sheet-margin-top sheet-vert-middle"><span class="sheet-new-feature"> ❗ </span>Notes:</div>
        <% # the attribute name `weaponSpecial` is retained here for compatibility with the other DCC sheet %>
        <div class="sheet-col-2-5"><input value="" type="text" name="<%= attr.name "rangedWeaponSpecial" %>" placeholder="Enter notes here. Ex: +1d4 damage vs trolls: [[1d4]]"></div>
      </div>
      <hr>
    </div>
  </div>
<% end %>
