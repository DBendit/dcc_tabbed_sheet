<div class="sheet-row">
  <div class="sheet-col-3-10">
    <%= yield :weapon_name %>
  </div>

  <div class="sheet-col-1-10">
    <%= render partial: "shared/melee_weapons/attack_die_selector", locals: { attr_name: attr.name("meleeAttackDice") } %>
  </div>

  <div class="sheet-col-1-10">
    <%= render partial: "shared/melee_weapons/crit_range_selector", locals: { attr_name: attr.name("meleeCritThreat") } %>
  </div>

  <div class="sheet-col-1-20">
    <%= render partial: "shared/melee_weapons/to_hit_mod", locals: { attr: attr } %>
  </div>

  <div class="sheet-col-1-20">
    <input class="sheet-center" value="1d4" type="text" name="<%= attr.name "meleeDmg" %>" title="Only enter the base damage roll here without any bonuses from stats or other sources">
  </div>

  <div class="sheet-col-1-20"><input class="sheet-center" type="number" name="<%= attr.name "meleeDmgBonus" %>" value="[[[[@{strMod}]] + @{<%= attr.roll "meleeMagic" %>} + @{<%= attr.roll "meleeOtherDamageBonus" %>} + @{meleeDmgLuckyRoll} + @{dmgLuckyRoll} + @{<%= attr.roll "zeroWeaponLuckyRoll" %>}]]" disabled="disabled"></div>

  <div class="sheet-col-1-20 sheet-checkbox-row" title="Check for advanced options">
    <input type="checkbox" value="@{<%= attr.roll "meleeShowAdvanced" %>}" name="<%= attr.name "meleeShowAdvanced" %>" class="sheet-melee-advanced">
  </div>

  <div class="sheet-col-1-14">
    <button type='roll' class="sheet-roll" name="roll_meleeWeaponAttack" title="Melee Weapon Attack" value="&{template:DccTabbed} {{background=[[0]]}} {{combat=1}} {{name=@{character_name}}} {{title=@{<%= attr.roll "meleeWeaponName" %>}}} {{wielded=@{<%= attr.roll "meleeAttackWielded" %>} }} {{attack=[[ @{<%= attr.roll "meleeAttackDice" %>}cs>@{<%= attr.roll "meleeCritThreat" %>} [To Hit Roll] + @{<%= attr.roll "meleeToHit" %>} [To Hit Bonus] + (?{Deed/Smite Die roll|0}) [Deed/Smite] + (?{Any Attack Bonus|0}) [Attack Bonus]  ]]  }} {{damage=[[ ({(@{<%= attr.roll "meleeDmg" %>} [Base damage] + @{<%= attr.roll "meleeDmgBonus" %>} [Damage Bonus] + (?{Deed/Smite Die roll|0}) [Deed/Smite Die]),1d1}kh1) ]]}} {{crit=[[ @{CritDie} + [[@{luckMod}]] + @{critLuckyRoll} ]]}} {{crittable=@{CritDie|max}}} {{fumble=[[ @{armorFumbleDie} + [[@{fumbleCheck}]] + [[@{fumbleLuckyRoll}]] ]]}} {{notes=@{<%= attr.roll "meleeWeaponSpecial" %>}}}">Attack</button>
  </div>

  <% unless local_assigns[:level0_mode] %>
    <div class="sheet-col-1-12">
      <button type='roll' class="sheet-roll" name="roll_meleeWeaponAttackWithDeed" title="Melee Weapon Attack with Mighty Deed" value="&{template:DccTabbed} [[ @{<%= attr.roll "meleeAttackDice" %>}cs>@{<%= attr.roll "meleeCritThreat" %>} [To Hit Roll] + [[@{DeedDie}cs>3]] [Deed Die] + @{<%= attr.roll "meleeToHit" %>} [To Hit Bonus] + (?{Any Attack Bonus|0}) [Attack Bonus]  ]] {{background=[[0]]}} {{combat=1}} {{name=@{character_name}}} {{title=@{<%= attr.roll "meleeWeaponName" %>}}} {{wielded=@{<%= attr.roll "meleeAttackWielded" %>} }} {{attackWithDeed=$[[1]] }} {{deedroll=$[[0]] }} {{damage=[[ ({(@{<%= attr.roll "meleeDmg" %>} [Base damage] + @{<%= attr.roll "meleeDmgBonus" %>} [Damage Bonus]),1d1}kh1) ]] + $[[0]] [Deed]}} {{crit=[[ @{CritDie} + [[@{luckMod}]] + @{critLuckyRoll} ]]}} {{crittable=@{CritDie|max}}} {{fumble=[[ @{armorFumbleDie} + [[@{fumbleCheck}]] + [[@{fumbleLuckyRoll}]] ]]}} {{notes=@{<%= attr.roll "meleeWeaponSpecial" %>}}}">w/ Deed</button>
    </div>

    <div class="sheet-col-1-14">
      <button type='roll' class="sheet-roll" name="roll_meleeWeaponBackstab" title="Melee Weapon Backstab" value="&{template:DccTabbed} {{background=[[0]]}} {{combat=1}} {{name=@{character_name}}} {{title=Backstab with @{<%= attr.roll "meleeWeaponName" %>}}} {{flavortext=You attack the enemy from behind or when they are unaware.  If the attack hits, it is a critical hit.}} {{backstab=[[ @{<%= attr.roll "meleeAttackDice" %>} [To Hit Roll] + @{<%= attr.roll "meleeToHit" %>} [To Hit Bonus] + @{ThiefBackstabCheck} [Backstab Bonus] + (?{Any Attack Bonus|0}) [Attack Bonus]  ]]  }} {{damage=[[ @{<%= attr.roll "meleeBackstabDmg" %>} [Base backstab damage] + @{<%= attr.roll "meleeDmgBonus" %>} [Damage Bonus] ]]}} {{crit=[[ @{CritDie} + [[@{luckMod}]] + @{critLuckyRoll} ]]}} {{crittable=@{CritDie|max}}} {{fumble=[[ @{armorFumbleDie} + [[@{fumbleCheck}]] + [[@{fumbleLuckyRoll}]] ]]}} {{notes=@{<%= attr.roll "meleeWeaponSpecial" %>}}}">Backstab</button>
    </div>
  <% end %>

  <input type="checkbox" value="@{<%= attr.roll "meleeShowAdvanced" %>}" name="<%= attr.name "meleeShowAdvanced" %>" class="sheet-melee-advanced2 sheet-hidden">

  <div class="sheet-melee-advanced sheet-row">
    <div class="sheet-row sheet-vert-middle">
      <div class="sheet-col-3-20 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Magic bonus:</div>
      <div class="sheet-col-1-20" title="The magic bonus will be added as a bonus to BOTH the attack and damage rolls">
        <input class=" sheet-center" type="number" name="<%= attr.name "meleeMagic" %>" value="0">
      </div>
      <div class="sheet-col-3-20 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">To Hit bonus:</div>
      <div class="sheet-col-1-20" title="Bonus added to ONLY hit rolls">
        <input class=" sheet-center" type="number" name="<%= attr.name "meleeOtherToHitBonus" %>" value="0">
      </div>
      <div class="sheet-col-3-20 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Backstab damage:</div>
      <div class="sheet-col-1-20" title="Enter the damage done on a backstab here. Usually this is the same as the normal damage dice"><input class="sheet-center" value="" type="text" name="<%= attr.name "meleeBackstabDmg" %>"></div>
      <div class="sheet-col-1-4 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Lucky Weapon:</div>
      <div class="sheet-col-1-20 sheet-left sheet-checkbox-row sheet-vert-middle" title="Check the box if this is your Lucky Weapon (Class ability)"><input type="checkbox" value="@{luckStartingMod}" name="<%= attr.name "meleeAtkLuckyWeapon" %>"></div>
    </div>
    <div class="sheet-row">
      <div class="sheet-col-7-20 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Damage bonus:</div>
      <div class="sheet-col-1-20" title="Bonus added to ONLY to damage rolls">
        <input class=" sheet-center" type="number" name="<%= attr.name "meleeOtherDamageBonus" %>" value="0">
      </div>
      <div class="sheet-col-3-20 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Wielded:</div>
      <div class="sheet-col-3-20" title="How is the weapon being wielded">
        <select name="<%= attr.name "meleeAttackWielded" %>">
          <option value="Primary Hand" selected="selected">Primary Hand</option>
          <option value="Two Handed">2 Handed</option>
          <option value="Off Hand">Off Hand</option>
          <option value="Off Hand (Halfling)">Off Hand (Half)</option>
        </select>
      </div>
      <div class="sheet-col-3-20 sheet-right sheet-padr sheet-margin-top sheet-vert-middle">Pack Hunter:</div>
      <div class="sheet-col-1-20 sheet-left sheet-checkbox-row sheet-vert-middle" title="Check the box if you have the Lucky Roll for 0-level Starting weapon"><input type="checkbox" value="@{luckStartingMod}" name="<%= attr.name "zeroWeaponLuckyRoll" %>"></div>
    </div>
    <div class="sheet-row" title="Enter other notes here; they will be shown during attacks, and can include rolls. Ex: +1d4 damage vs trolls: [[1d4]]">
      <div class="sheet-col-3-20 sheet-right sheet-padr sheet-margin-top sheet-vert-middle"><span class="sheet-new-feature"> ‚ùó </span>Notes:</div>
      <% # the attribute name `weaponSpecial` is retained here for compatibility with the other DCC sheet %>
      <div class="sheet-col-2-5"><input value="" type="text" name="<%= attr.name "meleeWeaponSpecial" %>" placeholder="Enter notes here. Ex: +1d4 damage vs trolls: [[1d4]]"></div>
    </div>
    <hr>
  </div>

</div>
